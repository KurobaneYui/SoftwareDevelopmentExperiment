# 备份软件BackupTool说明

## 实现功能

* 用户注册
* 用户登录
* 备份目录和文件
  * 备份目录
  * 备份普通文件
  * 备份硬链接
  * 备份软连接
  * 备份管道文件
* 将数据打包
* 将数据压缩：LZ78算法
* 将文件上传至服务器：TCP传输
* 管理服务器备份：Sqlite3维护数据
* 从服务器下载备份
* 解压缩文件
* 解包文件
* 还原文件
  * 还原文件数据
  * 还原普通文件
  * 还原管道文件
  * 还原软连接
  * 还原硬链接：如果硬链接指向文件在备份目录中存在，则和其他连接保持同一个inode信息
  * 还原目录
  * 还原所属用户和用户组
  * 还原文件（夹）权限
  * 还原文件类型
  * 还原文件最后访问时间（Atime或Last Access Time）

## 目录说明

* Client：客户端
  * compile/：保存各模块编译中间文件.o
  * includes/：保存头文件
  * sources/：保存源代码
  * tests/：保存测试用例代码和所需数据
  * test_directory/：测试用文件夹，测试用例代码需要用到此文件夹做备份测试，由于硬链接不能很好的跨系统打包还原代码（Windows会报错），所以此目录为空目录，请自行建立各种文件类型用于测试。

* Server：服务端
* documents/：设计文档

## 编译说明

### 客户端

* 编译环境：
  * Linux
  * G++
* 已测试环境：
  * Ubuntu20.04.1 x64 (GNU/Linux 5.10.102.1-microsoft-standard-WSL2)
  * G++ 9.4.0
  * C++标准：C++11、C++17
* 编译方式：
  * 在源码根目录运行指令`make`即可，生成可执行文件BackupTool也在根目录
* 优化：
  * 已在Makefile中启用`-O2`优化

### 服务器

* 编译环境：
  * Linux
  * G++
  * sqlite3开发库
    * 对于Ubuntu系统，请使用`sudo apt install sqlite3 libsqlite3-dev`安装使用
* 已测试环境：
  * Ubuntu20.04.1 x64 (GNU/Linux 5.4.0-96-generic x86_64)
  * G++ 9.4.0
  * Sqlite 3.31.1
* 编译方式：
  * 在源码根目录运行`g++ netTools.cpp server.cpp sqlcontrol.cpp -lsqlite3 -O2 -o server`即可编译，生成可执行文件server也在根目录
* 优化：
  * 上方编译代码中启用`-O2`优化

## 测试说明

> **注意：** 由于LZ78算法特性，对于小文件的压缩效果极差，30M文件压缩后会增至40M，因此请使用较大文件测试压缩效果，比如240M文件压缩可以在168M左右

### 工具

* gprof工具：用于性能分析
  * 编译选项中增加`-pg`并取消`-O2`
* valgrind工具：用于内存分析

### 测试用例

> 测试用例、所需数据、生成程序等均位于源码根目录下的tests文件夹内

测试用例使用额外Makefile，与测试代码一同位于根目录下的tests文件夹内，每一个.cpp源码均对应一个测试用例，编译后运行即可，编译说明请参考`./tests/ReadMe.md`

测试用例覆盖模块：FileCompressor、FileInfo、FilePacker、InodeRecorder

## 使用说明

### 客户端

直接运行并提供服务器IP和端口号即可，例如：`./BackupTool 192.168.3.100 8888`

客户端包含命令行界面，跟随提示操作即可

> 请运行前先运行服务端程序

### 服务端

直接运行并提供端口号即可：例如`./server 8888`

服务端运行后即保持，如需停止请使用`Ctrl + C`